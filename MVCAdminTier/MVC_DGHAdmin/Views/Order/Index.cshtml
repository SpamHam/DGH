@model IEnumerable<BLLGateway.DTOModels.OrderModelDTO>

@{
    ViewBag.Title = "Orders";
}

<h2>Orders</h2>

<p>
    @if (User.IsInRole("Admin"))
    {
        @Html.ActionLink("Create New", "Create")
    }
</p>
<table class="table">
<thead>
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Id)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.CustomerName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.OrderDate)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.ShippedDate)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.SumPurchase)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Shipping)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.SumShipping)
        </th>
        <th>
        </th>
    </tr>
</thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Id)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.CustomerName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.OrderDate)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.ShippedDate)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.SumPurchase)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Shipping)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.SumShipping)
                </td>
                <td>
                    @Html.ActionLink("Edit", "Edit", new {id = item.Id})|
                    @Html.ActionLink("Details", "Details", new { id = item.Id }) |
                    @Html.ActionLink("Delete", "Delete", new {id = item.Id})
                </td>
            </tr>
            <tr>
                <td colspan="8">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>
                                    </th>
                                    <th>
                                        @Html.DisplayNameFor(model => model.OrderLine.FirstOrDefault().ProductName)
                                    </th>
                                    <th>
                                        @Html.DisplayNameFor(model => model.OrderLine.FirstOrDefault().ProductPrice)
                                    </th>
                                    <th>
                                        @Html.DisplayNameFor(model => model.OrderLine.FirstOrDefault().Amount)
                                    </th>
                                    <th>
                                        @Html.DisplayNameFor(model => model.OrderLine.FirstOrDefault().LineTotal)
                                    </th>
                                    <th>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var lineItem in item.OrderLine)
                                {
                                    <tr>
                                        <th>
                                        </th>
                                        <td>
                                            @Html.DisplayFor(modelItem => lineItem.ProductName)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => lineItem.ProductPrice)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => lineItem.Amount)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => lineItem.LineTotal)
                                        </td>
                                        <td>
                                            @Html.ActionLink("Edit", "Edit", "Orderline", new { id = lineItem.Id }, null) |
                                            @Html.ActionLink("Details", "Details", "Orderline", new { id = lineItem.Id }, null) |
                                            @Html.ActionLink("Delete", "Delete", "Orderline", new { id = lineItem.Id }, null);
                                        </td>
                                    </tr>
                                }
                                <tr>
                                    <td colspan="8">
                                        @Html.ActionLink("Create new line", "Create", "Orderline", new { orderId = item.Id }, null);
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                </td>
            </tr>
        }
        </tbody>
</table>